{% extends "eys/base.html" %}

{% block content %}

<div style="background:white; padding:32px; border-radius:18px; box-shadow:0 22px 50px rgba(0,0,0,0.08); margin-bottom:35px;">
    <div style="display:flex; flex-wrap:wrap; gap:20px; justify-content:space-between; align-items:flex-start;">
        <div>
            <p style="margin:0; color:#9c9c9c; letter-spacing:0.08em; text-transform:uppercase; font-size:12px;">Ders Ã–zeti</p>
            <h1 style="margin:6px 0 10px 0; font-size:34px;">{{ course.name }} <span style="font-size:20px; color:#8f8f8f;">({{ course.code }})</span></h1>
            <p style="margin:0; color:#6f6f6f;">Ders sahibi: {{ instructor_name }} â€¢ DÃ¶nem: {{ term_label }}</p>
        </div>
        <div style="background:#f3fff6; border-radius:14px; padding:16px 20px; min-width:240px;">
            <p style="margin:0; font-size:13px; color:#1db954;">SÄ±radaki sÄ±nav</p>
            <strong style="display:block; margin-top:4px; font-size:18px;">{{ upcoming_exam_label }}</strong>
            <span style="font-size:12px; color:#7a7a7a;">Takvimde yer alÄ±r</span>
        </div>
    </div>
    <div style="margin-top:22px; display:grid; grid-template-columns:repeat(auto-fit,minmax(180px,1fr)); gap:16px;">
        <div style="background:#f7f7f7; border-radius:14px; padding:16px;">
            <p style="margin:0; font-size:13px; color:#7a7a7a;">Ã–ÄŸretim ElemanÄ±</p>
            <strong style="font-size:18px;">{{ instructor_name }}</strong>
        </div>
        <div style="background:#f7f7f7; border-radius:14px; padding:16px;">
            <p style="margin:0; font-size:13px; color:#7a7a7a;">Ã–ÄŸrenci SayÄ±sÄ±</p>
            <strong style="font-size:22px;">{{ student_count }}</strong>
        </div>
        <div style="background:#f7f7f7; border-radius:14px; padding:16px;">
            <p style="margin:0; font-size:13px; color:#7a7a7a;">LO</p>
            <strong style="font-size:22px;">{{ los|length }}</strong>
        </div>
        <div style="background:#f7f7f7; border-radius:14px; padding:16px;">
            <p style="margin:0; font-size:13px; color:#7a7a7a;">SÄ±nav</p>
            <strong style="font-size:22px;">{{ exams|length }}</strong>
        </div>
    </div>
</div>

{% if user.is_authenticated and course.instructor == user %}
<div style="text-align:center; margin:-10px 0 25px 0;">
    <a href="{% url 'teacher_assignment_create' %}?course_id={{ course.id }}"
       style="display:inline-block; background:#2459c3; color:white; padding:12px 18px; border-radius:10px; text-decoration:none; font-weight:700;">
        Bu derse Ã¶dev ekle
    </a>
</div>
{% endif %}

<div style="display:none;">
    <div style="background:white; border-radius:18px; padding:28px; box-shadow:0 12px 28px rgba(0,0,0,0.08);">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h2 style="margin:0;">Learning Outcomes</h2>
            <a href="/teacher/course/{{ course.id }}/add-lo/"
               style="background:#1db954; padding:10px 18px; color:white; border-radius:8px; text-decoration:none; font-weight:600;">
                LO Ekle +
            </a>
        </div>
        <div style="margin-top:20px; display:grid; grid-template-columns:repeat(auto-fill,minmax(200px,1fr)); gap:16px;">
            {% for lo in los %}
            <div onclick="openLOModal('lo-detail-{{ lo.id }}')"
                 style="background:#f9f9f9; padding:20px; border-radius:14px; border:1px solid #f0f0f0; cursor:pointer; transition:transform 0.15s, box-shadow 0.15s;"
                 onmouseover="this.style.boxShadow='0 10px 25px rgba(0,0,0,0.08)'; this.style.transform='translateY(-2px)';"
                 onmouseout="this.style.boxShadow='none'; this.style.transform='none';">
                <p style="margin:0; font-size:13px; color:#1db954;">LO {{ lo.id }}</p>
                <h3 style="margin:6px 0 0 0;">{{ lo.title }}</h3>
            </div>
            <div id="lo-detail-{{ lo.id }}" style="display:none;">
                <h3>LO {{ lo.id }} â€“ {{ lo.title }}</h3>
                <p><strong>Ä°Ã§erik:</strong> {{ lo.description|default:"HenÃ¼z aÃ§Ä±klama girilmemiÅŸ." }}</p>
                <p><strong>BaÄŸlÄ± OlduÄŸu SÄ±navlar:</strong></p>
                <ul style="padding-left:18px; margin-top:8px;">
                    {% for w in lo.examloweight_set.all %}
                        <li>{{ w.exam.name }} â€“ %{{ w.weight }}</li>
                    {% empty %}
                        <li>HenÃ¼z herhangi bir sÄ±nava baÄŸlÄ± deÄŸil.</li>
                    {% endfor %}
                </ul>
            </div>
            {% empty %}
            <p style="color:#999;">HenÃ¼z LO eklenmemiÅŸ.</p>
            {% endfor %}
        </div>
    </div>

    <div style="background:white; border-radius:18px; padding:28px; box-shadow:0 12px 28px rgba(0,0,0,0.08);">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h2 style="margin:0;">SÄ±navlar</h2>
            <a href="/teacher/course/{{ course.id }}/add-exam/"
               style="background:#1db954; padding:10px 18px; color:white; border-radius:8px; text-decoration:none; font-weight:600;">
                SÄ±nav Ekle +
            </a>
        </div>
        <div style="margin-top:20px; display:grid; grid-template-columns:repeat(auto-fill,minmax(240px,1fr)); gap:18px;">
            {% for exam in exams %}
            <div onclick="openExamModal('exam-detail-{{ exam.id }}')"
                 style="background:#f9f9f9; border-radius:14px; padding:20px; border:1px solid #f0f0f0; cursor:pointer; position:relative;">
                <a href="/teacher/exam/{{ exam.id }}/" onclick="event.stopPropagation();"
                   style="font-size:18px; font-weight:600; color:#1f1f1f; text-decoration:none;">{{ exam.name }}</a>
                <p style="font-size:14px; color:#666; margin:10px 0;">{{ exam.description|default:"AÃ§Ä±klama eklenmedi." }}</p>
                <p style="font-size:13px; color:#999; margin:0;">{{ exam.scheduled_at|date:"d.m.Y H:i" }}</p>
                <div style="margin-top:14px; display:flex; gap:10px; flex-wrap:wrap;">
                    <a href="/teacher/exam/{{ exam.id }}/add-lo-weight/" onclick="event.stopPropagation();"
                       style="flex:1; text-align:center; background:#1db954; color:white; padding:8px 0; border-radius:8px; text-decoration:none; font-size:13px;">
                        LO BaÄŸla
                    </a>
                    <a href="/teacher/exam/{{ exam.id }}/" onclick="event.stopPropagation();"
                       style="flex:1; text-align:center; border:1px solid #1db954; color:#1db954; padding:8px 0; border-radius:8px; text-decoration:none; font-size:13px;">
                        Detay
                    </a>
                </div>
                <div id="exam-detail-{{ exam.id }}" style="display:none;">
                    <h3>{{ exam.name }}</h3>
                    <p><strong>AÃ§Ä±klama:</strong> {{ exam.description|default:"BelirtilmemiÅŸ" }}</p>
                    <p><strong>Eklenme Tarihi:</strong> {{ exam.created_at|date:"d.m.Y H:i" }}</p>
                    <p><strong>SÄ±nav Tarihi:</strong> {{ exam.scheduled_at|date:"d.m.Y H:i" }}</p>
                    <div>
                        <p><strong>BaÄŸlÄ± LO'lar:</strong></p>
                        {% with weights=exam.examloweight_set.all %}
                            {% if weights %}
                                <ul style="padding-left:18px;">
                                {% for w in weights %}
                                    <li>LO {{ w.learning_outcome.id }} - {{ w.learning_outcome.title }} (%{{ w.weight }})</li>
                                {% endfor %}
                                </ul>
                            {% else %}
                                <p>HenÃ¼z LO baÄŸlanmamÄ±ÅŸ.</p>
                            {% endif %}
                        {% endwith %}
                    </div>
                    <a href="/teacher/exam/{{ exam.id }}/" style="display:inline-block; margin-top:10px; color:#1db954;">DÃ¼zenle / Detay</a>
                </div>
            </div>
            {% empty %}
            <p style="color:#999;">HenÃ¼z sÄ±nav eklenmemiÅŸ.</p>
            {% endfor %}
        </div>
    </div>

    <div style="background:white; border-radius:18px; padding:28px; box-shadow:0 12px 28px rgba(0,0,0,0.08);">
        <div style="display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap;">
            <h2 style="margin:0;">Materyaller</h2>
            <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
                <form method="get" style="display:flex; gap:8px; align-items:center; margin:0;">
                    <label for="mat-week" style="font-size:13px; color:#555;">Hafta:</label>
                    <select id="mat-week" name="week" onchange="this.form.submit()" style="padding:8px 10px; border-radius:10px; border:1px solid #e2e2e2;">
                        <option value="">TÃ¼mÃ¼</option>
                        {% for w in weeks %}
                            <option value="{{ w }}" {% if selected_week == w %}selected{% endif %}>Hafta {{ w }}</option>
                        {% endfor %}
                    </select>
                </form>
                {% if user.is_authenticated and course.instructor == user %}
                    <a href="{% url 'create_material' %}?course_id={{ course.id }}&next={% url 'course_detail' course.id %}"
                       style="background:#1db954; padding:10px 18px; color:white; border-radius:8px; text-decoration:none; font-weight:600;">
                        Materyal Ekle +
                    </a>
                {% endif %}
            </div>
        </div>
        <div style="margin-top:16px; display:flex; flex-direction:column; gap:10px;">
            {% if materials %}
                {% for m in materials %}
                    <div style="padding:12px; background:#f7f9fc; border-radius:12px; border:1px solid #eee;">
                        <div style="font-size:13px; color:#777;">Hafta {{ m.week }}</div>
                        <div style="font-weight:700; font-size:16px;">{{ m.title }}</div>
                        <div style="color:#555; font-size:14px;">{{ m.description|default:"" }}</div>
                        {% if m.attachment %}
                            <a href="{{ m.attachment.url }}" style="color:#2459c3;">Ä°ndir</a>
                        {% endif %}
                    </div>
                {% endfor %}
            {% else %}
                <p style="color:#777;">Materyal yok.</p>
            {% endif %}
        </div>
    </div>
</div>

<div style="margin-top:35px; background:white; border-radius:18px; padding:28px; box-shadow:0 20px 48px rgba(0,0,0,0.08);">
    <div style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:15px;">
        <div>
            <h2 style="margin:0;">ðŸ“¢ Ders DuyurularÄ±</h2>
            <p style="margin:6px 0 0 0; color:#7a7a7a;">Bu derse Ã¶zel son paylaÅŸÄ±lan mesajlar.</p>
        </div>
        <a href="{% url 'teacher_create_announcement' %}"
           style="padding:10px 18px; border:1px solid #1db954; border-radius:10px; color:#1db954; text-decoration:none; font-weight:600;">
            Yeni Duyuru OluÅŸtur
        </a>
    </div>
    <div style="margin-top:20px; display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); gap:20px;">
        {% for ann in announcement_cards %}
        <div style="border:1px solid #f0f0f0; border-radius:16px; padding:20px; background:#fcfcfc;">
            <div style="display:flex; align-items:center; gap:12px;">
                <div style="width:42px; height:42px; border-radius:12px; background:#1db954; color:white; display:flex; align-items:center; justify-content:center; font-weight:600;">
                    {{ ann.initials }}
                </div>
                <div>
                    <strong style="display:block;">{{ ann.author }}</strong>
                    <span style="font-size:12px; color:#8f8f8f;">{{ ann.timestamp }}</span>
                </div>
            </div>
            <h3 style="margin:14px 0 6px 0;">{{ ann.title }}</h3>
            <p style="margin:0; color:#666; white-space:pre-line;">{{ ann.body }}</p>
        </div>
        {% empty %}
        <div style="border:1px dashed #cfcfcf; border-radius:16px; padding:30px; text-align:center; color:#9a9a9a;">
            Bu ders iÃ§in henÃ¼z duyuru oluÅŸturulmadÄ±.
        </div>
        {% endfor %}
    </div>
</div>

<div id="student-roster" style="margin-top:35px; display:flex; gap:24px; flex-wrap:wrap;">
    <div style="flex:1.2; min-width:320px; background:white; border-radius:18px; padding:26px; box-shadow:0 20px 48px rgba(0,0,0,0.08);">
        <div style="display:flex; flex-wrap:wrap; gap:12px; align-items:center; margin-bottom:20px;">
            <div style="flex:1; min-width:220px;">
                <label style="font-size:13px; color:#7a7a7a; display:block; margin-bottom:6px;">Ã–ÄŸrenci Ara</label>
                <input id="student-search" type="text" placeholder="Ä°sim veya kullanÄ±cÄ± adÄ±"
                       style="width:100%; padding:10px 14px; border:1px solid #e0e0e0; border-radius:10px;">
            </div>
            <div style="width:180px;">
                <label style="font-size:13px; color:#7a7a7a; display:block; margin-bottom:6px;">Durum Filtresi</label>
                <select id="student-filter" style="width:100%; padding:10px 14px; border:1px solid #e0e0e0; border-radius:10px;">
                    <option value="">TÃ¼mÃ¼</option>
                    <option value="Ä°stikrarlÄ±">Ä°stikrarlÄ±</option>
                    <option value="Takipte">Takipte</option>
                    <option value="Destek Gerekli">Destek Gerekli</option>
                </select>
            </div>
        </div>
        <div id="student-list" style="display:flex; flex-direction:column; gap:12px; max-height:480px; overflow:auto;">
            {% for student in student_cards %}
            <button class="student-chip"
                    data-name="{{ student.name|lower }}"
                    data-status="{{ student.status }}"
                    data-email="{{ student.email }}"
                    data-username="{{ student.username }}"
                    data-last-login="{{ student.last_login }}"
                    data-joined="{{ student.date_joined }}"
                    data-course-load="{{ student.course_load }}"
                    data-progress="{{ student.activity_score }}"
                    data-status-color="{{ student.status_color }}"
                    data-upcoming="{{ student.upcoming_exam }}"
                    style="border:1px solid #f0f0f0; border-radius:12px; padding:14px; display:flex; align-items:center; gap:14px; background:#fff; cursor:pointer; text-align:left;">
                <div style="width:46px; height:46px; border-radius:50%; background:#f3fff6; display:flex; align-items:center; justify-content:center; font-weight:600; color:#1db954;">
                    {{ student.initials }}
                </div>
                <div style="flex:1;">
                    <strong style="display:block;">{{ student.name }}</strong>
                    <span style="font-size:13px; color:#8a8a8a;">{{ student.email }}</span>
                </div>
                <span style="font-size:13px; color:#7a7a7a;">{{ student.status }}</span>
            </button>
            {% empty %}
            <p style="color:#999;">Bu derse kayÄ±tlÄ± Ã¶ÄŸrenci bulunmuyor.</p>
            {% endfor %}
        </div>
    </div>
    <div style="flex:1; min-width:280px; background:white; border-radius:18px; padding:26px; box-shadow:0 20px 48px rgba(0,0,0,0.08); position:sticky; top:20px;">
        <div id="student-detail-empty" style="text-align:center; color:#a0a0a0; padding:40px 0;">
            Bir Ã¶ÄŸrenciyi seÃ§erek detaylarÄ±nÄ± gÃ¶rÃ¼ntÃ¼leyin.
        </div>
        <div id="student-detail" style="display:none;">
            <div style="display:flex; align-items:center; gap:14px;">
                <div id="detail-avatar" style="width:56px; height:56px; border-radius:16px; background:#f3fff6; display:flex; align-items:center; justify-content:center; font-size:24px; color:#1db954;"></div>
                <div>
                    <h3 id="detail-name" style="margin:0;"></h3>
                    <p id="detail-username" style="margin:4px 0 0 0; color:#777;"></p>
                </div>
            </div>
            <p id="detail-email" style="margin:18px 0 6px 0; color:#555;"></p>
            <div>
                <p style="margin:0; font-size:13px; color:#7a7a7a;">Performans</p>
                <div style="background:#f5f5f5; border-radius:999px; height:10px; margin:8px 0;">
                    <div id="detail-progress" style="height:10px; border-radius:999px; width:0%; background:#1db954;"></div>
                </div>
                <span id="detail-status" style="font-size:13px; font-weight:600;"></span>
            </div>
            <div style="margin-top:18px; display:grid; grid-template-columns:repeat(auto-fit,minmax(140px,1fr)); gap:14px;">
                <div style="background:#f9f9f9; border-radius:12px; padding:12px;">
                    <p style="margin:0; font-size:12px; color:#7a7a7a;">KayÄ±t Tarihi</p>
                    <strong id="detail-joined"></strong>
                </div>
                <div style="background:#f9f9f9; border-radius:12px; padding:12px;">
                    <p style="margin:0; font-size:12px; color:#7a7a7a;">Son GiriÅŸ</p>
                    <strong id="detail-last-login"></strong>
                </div>
                <div style="background:#f9f9f9; border-radius:12px; padding:12px;">
                    <p style="margin:0; font-size:12px; color:#7a7a7a;">Toplam Ders</p>
                    <strong id="detail-course-load"></strong>
                </div>
                <div style="background:#f9f9f9; border-radius:12px; padding:12px;">
                    <p style="margin:0; font-size:12px; color:#7a7a7a;">YaklaÅŸan SÄ±nav</p>
                    <strong id="detail-upcoming"></strong>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="loModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5);">
    <div style="width:420px; background:white; padding:20px; border-radius:10px; margin:100px auto;">
        <div id="loModalContent"></div>
        <button onclick="closeLOModal()"
                style="margin-top:20px; background:#1db954; padding:10px 20px; border:none; border-radius:6px; color:white;">
            Kapat
        </button>
    </div>
</div>

<style>
  .panel {
    background: #fff;
    border-radius: 16px;
    padding: 18px 20px;
    box-shadow: 0 12px 30px rgba(0,0,0,0.08);
    border: 1px solid #eef0f4;
  }
  .panel summary {
    list-style: none;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 10px;
  }
  .panel summary::-webkit-details-marker { display: none; }
  .pill {
    background:#f1f4ff;
    color:#2459c3;
    padding:4px 10px;
    border-radius:12px;
    font-size:12px;
    font-weight:600;
  }
</style>

<div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(340px,1fr)); gap:18px; margin-top:20px;">
    <div class="panel">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h3 style="margin:0;">Learning Outcomes</h3>
            <a href="/teacher/course/{{ course.id }}/add-lo/" style="background:#1db954; padding:9px 14px; color:white; border-radius:10px; text-decoration:none; font-weight:600;">LO Ekle</a>
        </div>
        <div style="margin-top:12px; display:flex; flex-direction:column; gap:8px;">
            {% for lo in los %}
                <details style="background:#f7f9fc; border:1px solid #eef0f4; border-radius:12px; padding:10px;">
                    <summary>
                        <span style="font-weight:700; color:#1f1f1f;">LO {{ lo.id }} â€” {{ lo.title }}</span>
                        <span class="pill">Detay</span>
                    </summary>
                    <p style="margin:8px 0 4px 0; color:#555;">{{ lo.description|default:"HenÃ¼z aÃ§Ä±klama girilmemiÅŸ." }}</p>
                    <p style="margin:0; font-size:13px; color:#777;">BaÄŸlÄ± sÄ±navlar:</p>
                    <ul style="padding-left:18px; margin:4px 0 0 0; color:#555;">
                        {% for w in lo.examloweight_set.all %}
                            <li>{{ w.exam.name }} â€“ %{{ w.weight }}</li>
                        {% empty %}
                            <li>HenÃ¼z sÄ±nav yok.</li>
                        {% endfor %}
                    </ul>
                </details>
            {% empty %}
                <p style="color:#999;">HenÃ¼z LO eklenmemiÅŸ.</p>
            {% endfor %}
        </div>
    </div>

    <div class="panel">
        <div style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:10px;">
            <h3 style="margin:0;">SÄ±navlar</h3>
            <a href="/teacher/course/{{ course.id }}/add-exam/" style="background:#1db954; padding:9px 14px; color:white; border-radius:10px; text-decoration:none; font-weight:600;">SÄ±nav Ekle</a>
        </div>
        <div style="margin-top:12px; display:flex; flex-direction:column; gap:8px;">
            {% for exam in exams %}
                <details style="background:#f7f9fc; border:1px solid #eef0f4; border-radius:12px; padding:10px;">
                    <summary>
                        <span style="font-weight:700;">{{ exam.name }} â€” {{ exam.scheduled_at|date:"d.m.Y H:i"|default:"Tarih bekleniyor" }}</span>
                        <span class="pill">AÃ§</span>
                    </summary>
                    <p style="margin:6px 0; color:#555;">{{ exam.description|default:"AÃ§Ä±klama eklenmedi." }}</p>
                    <div style="display:flex; gap:8px; flex-wrap:wrap;">
                        <a href="/teacher/exam/{{ exam.id }}/add-lo-weight/" style="color:#1db954;">LO BaÄŸla</a>
                        <a href="/teacher/exam/{{ exam.id }}/" style="color:#2459c3;">Detay</a>
                    </div>
                </details>
            {% empty %}
                <p style="color:#999;">SÄ±nav yok.</p>
            {% endfor %}
        </div>
    </div>

    <div class="panel">
        <div style="display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap;">
            <h3 style="margin:0;">Materyaller</h3>
            <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
                <form method="get" style="display:flex; gap:8px; align-items:center; margin:0;">
                    <label for="mat-week" style="font-size:13px; color:#555;">Hafta:</label>
                    <select id="mat-week" name="week" onchange="this.form.submit()" style="padding:8px 10px; border-radius:10px; border:1px solid #e2e2e2;">
                        <option value="">TÃ¼mÃ¼</option>
                        {% for w in weeks %}
                            <option value="{{ w }}" {% if selected_week == w %}selected{% endif %}>Hafta {{ w }}</option>
                        {% endfor %}
                    </select>
                </form>
                {% if user.is_authenticated and course.instructor == user %}
                    <a href="{% url 'create_material' %}?course_id={{ course.id }}&next={% url 'course_detail' course.id %}"
                       style="background:#1db954; padding:9px 14px; color:white; border-radius:10px; text-decoration:none; font-weight:600;">
                        Materyal Ekle
                    </a>
                {% endif %}
            </div>
        </div>
        <div style="margin-top:12px; display:flex; flex-direction:column; gap:8px;">
            {% if materials %}
                {% for m in materials %}
                    <details style="background:#f7f9fc; border:1px solid #eee; border-radius:12px; padding:10px;">
                        <summary>
                            <span style="font-weight:700;">Hafta {{ m.week }} â€” {{ m.title }}</span>
                            <span class="pill">Detay</span>
                        </summary>
                        <p style="margin:6px 0; color:#555;">{{ m.description|default:"" }}</p>
                        {% if m.attachment %}
                            <a href="{{ m.attachment.url }}" style="color:#2459c3;">Ä°ndir</a>
                        {% endif %}
                    </details>
                {% endfor %}
            {% else %}
                <p style="color:#777;">Materyal yok.</p>
            {% endif %}
        </div>
    </div>
</div>

<div id="examModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5);">
    <div style="width:520px; background:white; padding:25px; border-radius:10px; margin:80px auto;">
        <div id="examModalContent"></div>
        <button onclick="closeExamModal()"
                style="margin-top:20px; background:#1db954; padding:10px 20px; border:none; border-radius:6px; color:white;">
            Kapat
        </button>
    </div>
</div>

<script>
function openLOModal(contentId) {
    var html = document.getElementById(contentId).innerHTML;
    document.getElementById("loModalContent").innerHTML = html;
    document.getElementById("loModal").style.display = "block";
}
function closeLOModal() {
    document.getElementById("loModal").style.display = "none";
}

function openExamModal(contentId) {
    var html = document.getElementById(contentId).innerHTML;
    document.getElementById("examModalContent").innerHTML = html;
    document.getElementById("examModal").style.display = "block";
}
function closeExamModal() {
    document.getElementById("examModal").style.display = "none";
}

(function() {
    const searchInput = document.getElementById("student-search");
    const filterSelect = document.getElementById("student-filter");
    const studentItems = Array.from(document.querySelectorAll(".student-chip"));
    const detailPane = document.getElementById("student-detail");
    const emptyPane = document.getElementById("student-detail-empty");

    function filterStudents() {
        const query = (searchInput.value || "").toLowerCase();
        const status = filterSelect.value;
        let visibleCount = 0;
        studentItems.forEach(function(item) {
            const matchesText = item.dataset.name.indexOf(query) > -1;
            const matchesStatus = !status || item.dataset.status === status;
            if (matchesText && matchesStatus) {
                item.style.display = "flex";
                visibleCount += 1;
            } else {
                item.style.display = "none";
            }
        });
        if (visibleCount === 0) {
            emptyPane.textContent = "Filtreye uyan Ã¶ÄŸrenci bulunamadÄ±.";
            emptyPane.style.display = "block";
            detailPane.style.display = "none";
        }
    }

    function selectStudent(item) {
        studentItems.forEach(function(btn) { btn.classList.remove("active-student"); });
        item.classList.add("active-student");
        document.getElementById("detail-avatar").textContent = item.querySelector("div").textContent.trim();
        document.getElementById("detail-name").textContent = item.querySelector("strong").textContent.trim();
        document.getElementById("detail-username").textContent = "@" + item.dataset.username;
        document.getElementById("detail-email").textContent = item.dataset.email;
        document.getElementById("detail-joined").textContent = item.dataset.joined;
        document.getElementById("detail-last-login").textContent = item.dataset.lastLogin;
        document.getElementById("detail-course-load").textContent = item.dataset.courseLoad;
        document.getElementById("detail-upcoming").textContent = item.dataset.upcoming;
        document.getElementById("detail-progress").style.width = item.dataset.progress + "%";
        document.getElementById("detail-progress").style.background = item.dataset.statusColor;
        document.getElementById("detail-status").textContent = item.dataset.status;
        document.getElementById("detail-status").style.color = item.dataset.statusColor;
        emptyPane.style.display = "none";
        detailPane.style.display = "block";
    }

    studentItems.forEach(function(item) {
        item.addEventListener("click", function() { selectStudent(item); });
    });

    if (studentItems.length) {
        selectStudent(studentItems[0]);
    }

    if (searchInput) searchInput.addEventListener("input", filterStudents);
    if (filterSelect) filterSelect.addEventListener("change", filterStudents);
})();
</script>

{% endblock %}
