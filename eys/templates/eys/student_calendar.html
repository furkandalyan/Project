{% extends "eys/base.html" %}
{% load i18n %}

{% block content %}
<div style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:16px; margin-bottom:25px;">
    <div>
        <p style="margin:0; color:#9b9b9b;">PlanlÄ± sÄ±navlarÄ±nÄ± buradan yÃ¶net</p>
        <h1 style="margin:4px 0 0 0;">ğŸ“
 Takvimim</h1>
    </div>
    <div style="display:flex; gap:8px; flex-wrap:wrap; align-items:center;">
        <a href="?year={{ prev_month.year }}&month={{ prev_month.month }}"
           style="padding:10px 16px; border:1px solid var(--border-color); border-radius:8px; text-decoration:none; color:var(--text-color);">â† Ã–nceki Ay</a>

        <form method="GET" style="display:flex; gap:8px;">
            <select name="month" onchange="this.form.submit()" style="padding:10px; border-radius:8px; border:1px solid var(--border-color); background:var(--input-bg); color:var(--text-color); font-weight:600;">
                <option value="1" {% if month_name == 'Ocak' %}selected{% endif %}>Ocak</option>
                <option value="2" {% if month_name == 'Åubat' %}selected{% endif %}>Åubat</option>
                <option value="3" {% if month_name == 'Mart' %}selected{% endif %}>Mart</option>
                <option value="4" {% if month_name == 'Nisan' %}selected{% endif %}>Nisan</option>
                <option value="5" {% if month_name == 'MayÄ±s' %}selected{% endif %}>MayÄ±s</option>
                <option value="6" {% if month_name == 'Haziran' %}selected{% endif %}>Haziran</option>
                <option value="7" {% if month_name == 'Temmuz' %}selected{% endif %}>Temmuz</option>
                <option value="8" {% if month_name == 'AÄŸustos' %}selected{% endif %}>AÄŸustos</option>
                <option value="9" {% if month_name == 'EylÃ¼l' %}selected{% endif %}>EylÃ¼l</option>
                <option value="10" {% if month_name == 'Ekim' %}selected{% endif %}>Ekim</option>
                <option value="11" {% if month_name == 'KasÄ±m' %}selected{% endif %}>KasÄ±m</option>
                <option value="12" {% if month_name == 'AralÄ±k' %}selected{% endif %}>AralÄ±k</option>
            </select>
            <select name="year" onchange="this.form.submit()" style="padding:10px; border-radius:8px; border:1px solid var(--border-color); background:var(--input-bg); color:var(--text-color); font-weight:600;">
                {% for y in "2023 2024 2025 2026 2027"|make_list %}
                    <!-- Basit bir liste yerine view'dan yil araligi gelse daha iyi olur ama simdilik statik cozum -->
                    <!-- Template tag destegi olmadigi icin asagidaki gibi manuel yapiyorum -->
                {% endfor %}
                <option value="{{ selected_year|add:'-2' }}">{{ selected_year|add:'-2' }}</option>
                <option value="{{ selected_year|add:'-1' }}">{{ selected_year|add:'-1' }}</option>
                <option value="{{ selected_year }}" selected>{{ selected_year }}</option>
                <option value="{{ selected_year|add:'1' }}">{{ selected_year|add:'1' }}</option>
                <option value="{{ selected_year|add:'2' }}">{{ selected_year|add:'2' }}</option>
            </select>
        </form>

        <a href="?year={{ next_month.year }}&month={{ next_month.month }}"
           style="padding:10px 16px; border:1px solid var(--border-color); border-radius:8px; text-decoration:none; color:var(--text-color);">Sonraki Ay â†’</a>
    </div>
</div>

<div style="display:grid; grid-template-columns:3fr 1fr; gap:30px; align-items:flex-start; flex-wrap:wrap;">
    <div style="background:white; border-radius:16px; padding:25px; box-shadow:0 20px 45px rgba(0,0,0,0.07);">
        <div style="display:grid; grid-template-columns:repeat(7,1fr); text-align:center; font-weight:600; color:#777; margin-bottom:12px;">
            {% for label in weekday_labels %}
                <div>{{ label }}</div>
            {% endfor %}
        </div>
        <div style="display:grid; grid-template-columns:repeat(7,1fr); gap:10px;">
            {% for row in calendar_rows %}
                {% for cell in row %}
                    {% if cell %}
                        <div style="border:1px solid {% if cell.items %}#1db954{% else %}var(--border-color){% endif %}; border-radius:14px; padding:12px; min-height:120px; display:flex; flex-direction:column; gap:8px; position:relative;">
                            <div style="display:flex; justify-content:space-between; align-items:center;">
                                <span style="font-weight:600; {% if cell.is_today %}color:#1db954;{% endif %}">{{ cell.day }}</span>
                                {% if cell.is_today %}
                                    <span style="font-size:11px; background:#e8f9ef; color:#1d7c4a; padding:2px 8px; border-radius:999px;">BugÃ¼n</span>
                                {% endif %}
                            </div>
                            <div style="display:flex; flex-direction:column; gap:6px;">
                                {% for exam in cell.items %}
                                    <div style="border-radius:10px; padding:8px; background:var(--badge-bg); border: 1px solid var(--border-color);">
                                        <p style="margin:0; font-weight:600; font-size:13px; color:var(--text-color);">{{ exam.course_code }} Â· {{ exam.name }}</p>
                                        <p style="margin:2px 0 8px 0; color:var(--text-muted); font-size:12px;">{{ exam.time_label }} â€¢ {{ exam.course_name }}</p>
                                        <div style="display:flex; gap:8px;">
                                            <a href="{% url 'exam_detail' exam.id %}"
                                               style="flex:1; text-align:center; font-size:12px; padding:6px 0; border-radius:6px; background:#1db954; color:white; text-decoration:none;">SÄ±nav DetayÄ±</a>
                                            <a href="{% url 'student_course_detail' exam.course_id %}"
                                               style="flex:1; text-align:center; font-size:12px; padding:6px 0; border-radius:6px; border:1px solid #1db954; color:#1db954; text-decoration:none;">Ders</a>
                                        </div>
                                    </div>
                                {% empty %}
                                    <p style="margin:0; font-size:12px; color:#bbb;">Etkinlik yok</p>
                                {% endfor %}
                            </div>
                        </div>
                    {% else %}
                        <div style="border:1px dashed var(--border-color); border-radius:14px;"></div>
                    {% endif %}
                {% endfor %}
            {% endfor %}
        </div>
        {% if not has_events %}
            <div style="margin-top:20px; padding:18px; border-radius:12px; background:var(--badge-bg); text-align:center; color:var(--text-muted);">
                Bu ay iÃ§in planlanmÄ±ÅŸ sÄ±nav gÃ¶rÃ¼nmÃ¼yor. Ã–ÄŸretim elemanÄ± yeni sÄ±nav eklediÄŸinde otomatik olarak burada belirecek.
            </div>
        {% endif %}
    </div>

    <div style="background:white; border-radius:16px; padding:25px; box-shadow:0 20px 45px rgba(0,0,0,0.07);">
        <h3 style="margin-top:0;">YaklaÅŸan SÄ±navlar</h3>
        <p style="margin:4px 0 15px 0; color:#888;">Yeni eklenen ilk 6 sÄ±nav listelenir.</p>
        {% if upcoming_list %}
            <div style="display:flex; flex-direction:column; gap:12px;">
                {% for exam in upcoming_list %}
                    <div style="border:1px solid var(--border-color); border-radius:12px; padding:14px;">
                        <p style="margin:0; font-size:13px; color:#999;">{{ exam.display_label }}</p>
                        <strong style="display:block; margin:4px 0;">{{ exam.course_code }} Â· {{ exam.name }}</strong>
                        <p style="margin:0; color:#666; font-size:13px;">{{ exam.course_name }}</p>
                        <div style="margin-top:10px; display:flex; gap:8px;">
                            <a href="{% url 'exam_detail' exam.id %}"
                               style="flex:1; text-align:center; font-size:12px; padding:6px 0; border-radius:6px; background:#1f1f1f; color:white; text-decoration:none;">{% trans "Detay" %}</a>
                            <a href="{% url 'student_course_detail' exam.course_id %}"
                               style="flex:1; text-align:center; font-size:12px; padding:6px 0; border-radius:6px; border:1px solid #1f1f1f; color:#1f1f1f; text-decoration:none;">Ders</a>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div style="border:1px dashed #dcdcdc; border-radius:12px; padding:18px; text-align:center; color:#999;">
                YaklaÅŸan sÄ±nav yok. Takvimi daha sonra tekrar kontrol et.
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}