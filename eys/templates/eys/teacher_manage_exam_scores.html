{% extends "eys/base.html" %}

{% block content %}
<div style="background:white; border-radius:20px; padding:30px; box-shadow:0 25px 60px rgba(0,0,0,0.08); margin-bottom:25px;">
    <p style="margin:0; color:#9a9a9a; text-transform:uppercase; letter-spacing:0.08em; font-size:12px;">Sınav Not Girişi</p>
    <h1 style="margin:6px 0 0 0;">{{ exam.course.code }} • {{ exam.name }}</h1>
    <p style="color:#666;">Bu dersin tüm öğrencileri için skor ve geri bildirim girebilirsin. Boş bıraktığın satırlar silinir.</p>
</div>

<form method="POST" style="background:white; border-radius:20px; padding:24px; box-shadow:0 20px 50px rgba(0,0,0,0.08); display:flex; flex-direction:column; gap:18px;">
    {% csrf_token %}
    <div style="overflow-x:auto;">
        <table style="width:100%; border-collapse:collapse;">
            <thead>
                <tr style="background:#f8f8f8;">
                    <th style="text-align:left; padding:12px;">Öğrenci</th>
                    <th style="text-align:left; padding:12px;">Skor (0-100)</th>
                    <th style="text-align:left; padding:12px;">Geri Bildirim</th>
                </tr>
            </thead>
            <tbody>
                {% for row in student_rows %}
                {% with student=row.student result=row.result %}
                <tr style="border-bottom:1px solid #f0f0f0;">
                    <td style="padding:12px;">
                        <strong>{{ student.get_full_name|default:student.username }}</strong>
                        <span style="display:block; color:#888; font-size:13px;">{{ student.email|default:"E-posta yok" }}</span>
                    </td>
                    <td style="padding:12px;">
                        <input type="number" step="0.01" min="0" max="100" name="score_{{ student.id }}" value="{% if result %}{{ result.score }}{% endif %}"
                               style="width:120px; padding:10px; border-radius:10px; border:1px solid #ddd;">
                    </td>
                    <td style="padding:12px;">
                        <textarea name="feedback_{{ student.id }}" rows="2" style="width:100%; padding:10px; border-radius:10px; border:1px solid #ddd;">{% if result %}{{ result.feedback }}{% endif %}</textarea>
                    </td>
                </tr>
                {% endwith %}
                {% empty %}
                <tr><td colspan="3" style="padding:20px; text-align:center; color:#999;">Bu derse kayıtlı öğrenci bulunmuyor.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <div style="display:flex; justify-content:flex-end; gap:12px;">
        <a href="{% url 'exam_detail' exam.id %}"
           style="padding:12px 20px; border-radius:12px; border:1px solid #ccc; text-decoration:none; color:#333;">İptal</a>
        <button type="submit"
                style="padding:12px 24px; border:none; border-radius:12px; background:#1db954; color:white; font-weight:600;">
            Notları Kaydet
        </button>
    </div>
</form>
{% endblock %}

