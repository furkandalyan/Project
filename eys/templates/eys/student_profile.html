{% extends "eys/base.html" %}
{% load i18n %}

{% block content %}
<style>
    /* Form inputlarını düzeltmek için ek stiller */
    input[type="text"],
    input[type="email"],
    input[type="password"] {
        width: 100%;
        padding: 12px;
        border: 1px solid #e4e4e7;
        border-radius: 8px;
        box-sizing: border-box; /* Padding'in genişliğe dahil olmasını sağlar */
        font-size: 14px;
        transition: border-color 0.2s;
    }

    input[type="text"]:focus,
    input[type="email"]:focus,
    input[type="password"]:focus {
        border-color: #1db954;
        outline: none;
    }

    /* Readonly inputlar için stil */
    input[readonly] {
        background-color: #f4f4f5;
        color: #71717a;
        cursor: not-allowed;
    }
</style>

<div style="display:flex; flex-wrap:wrap; gap:24px;">
    <div style="flex:1; min-width:320px; background:white; border-radius:20px; padding:32px; box-shadow:0 25px 55px rgba(0,0,0,0.08);">
        <p style="margin:0; color:#9c9c9c; letter-spacing:0.08em; text-transform:uppercase; font-size:12px;">Profil Bilgilerin</p>
        <h1 style="margin:6px 0 18px 0;">{{ request.user.get_full_name|default:request.user.username }}</h1>

        <form method="POST" style="display:flex; flex-direction:column; gap:20px;">
            {% csrf_token %}
            {% if form.non_field_errors %}
                <div style="background:#fff2f2; border:1px solid #ffbcbc; color:#c20000; padding:12px; border-radius:10px;">
                    {{ form.non_field_errors }}
                </div>
            {% endif %}

            <div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:20px;">
                <div>
                    <label for="{{ form.first_name.id_for_label }}" style="font-weight:600; color:#333; display:block; margin-bottom:8px;">Ad</label>
                    {{ form.first_name }}
                    {% for error in form.first_name.errors %}<span style="color:#d00000; font-size:13px; display:block; margin-top:4px;">{{ error }}</span>{% endfor %}
                </div>
                <div>
                    <label for="{{ form.last_name.id_for_label }}" style="font-weight:600; color:#333; display:block; margin-bottom:8px;">Soyad</label>
                    {{ form.last_name }}
                    {% for error in form.last_name.errors %}<span style="color:#d00000; font-size:13px; display:block; margin-top:4px;">{{ error }}</span>{% endfor %}
                </div>
            </div>

            <div>
                <label for="{{ form.email.id_for_label }}" style="font-weight:600; color:#333; display:block; margin-bottom:8px;">E-posta (Değiştirilemez)</label>
                <input type="email" name="email" value="{{ form.email.value|default:'' }}" readonly id="{{ form.email.id_for_label }}">
                {% if form.email.help_text %}
                <p style="margin:4px 0 0 0; font-size:12px; color:#666;">{{ form.email.help_text }}</p>
                {% endif %}
            </div>

            <hr style="border:none; border-top:1px solid #f0f0f0; margin:10px 0;">

            <div>
                <p style="margin:0 0 12px 0; color:#6c6c6c;">Parolayı güncellemek istemiyorsan aşağıdaki alanları boş bırakabilirsin.</p>
                <div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:20px;">
                    <div>
                        <label for="{{ form.new_password.id_for_label }}" style="font-weight:600; color:#333; display:block; margin-bottom:8px;">Yeni Parola</label>
                        {{ form.new_password }}
                    </div>
                    <div>
                        <label for="{{ form.confirm_password.id_for_label }}" style="font-weight:600; color:#333; display:block; margin-bottom:8px;">Parola Tekrar</label>
                        {{ form.confirm_password }}
                    </div>
                </div>
            </div>

            <button type="submit"
                    style="padding:14px 0; border:none; border-radius:12px; background:linear-gradient(120deg,#1db954,#119c45); color:white; font-weight:600; font-size:16px; cursor:pointer; margin-top:10px;">
                Değişiklikleri Kaydet
            </button>
        </form>
    </div>

    <div style="flex:0.8; min-width:280px; display:flex; flex-direction:column; gap:20px;">
        <div style="background:white; border-radius:20px; padding:24px; box-shadow:0 20px 45px rgba(0,0,0,0.08);">
            <h3 style="margin-top:0;">Hesap Özeti</h3>
            <div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(160px,1fr)); gap:14px;">
                <div style="background:#f8f8f8; border-radius:14px; padding:14px;">
                    <p style="margin:0; font-size:12px; color:#7a7a7a;">Kullanıcı Adı</p>
                    <strong>{{ username }}</strong>
                </div>
                <div style="background:#f8f8f8; border-radius:14px; padding:14px;">
                    <p style="margin:0; font-size:12px; color:#7a7a7a;">Rol</p>
                    <strong>{{ role_name }}</strong>
                </div>
                <div style="background:#f8f8f8; border-radius:14px; padding:14px;">
                    <p style="margin:0; font-size:12px; color:#7a7a7a;">Katılım Tarihi</p>
                    <strong>{{ joined_date }}</strong>
                </div>
                <div style="background:#f8f8f8; border-radius:14px; padding:14px;">
                    <p style="margin:0; font-size:12px; color:#7a7a7a;">Son Giriş</p>
                    <strong>{{ last_login }}</strong>
                </div>
            </div>
        </div>


        <div style="background:white; border-radius:20px; padding:24px; box-shadow:0 20px 45px rgba(0,0,0,0.08); border:1px solid #eef0f4;">
            <h3 style="margin-top:0;">Danisman Bilgileri</h3>
            {% if advisor_name %}
            <div style="display:flex; flex-direction:column; gap:10px;">
                <div style="background:#f8f8f8; border-radius:12px; padding:12px;">
                    <p style="margin:0; font-size:12px; color:#7a7a7a;">Ad Soyad</p>
                    <strong>{{ advisor_name }}</strong>
                </div>
                <div style="background:#f8f8f8; border-radius:12px; padding:12px;">
                    <p style="margin:0; font-size:12px; color:#7a7a7a;">Kullanici Adi</p>
                    <strong>@{{ advisor_username }}</strong>
                </div>
                <div style="background:#f8f8f8; border-radius:12px; padding:12px;">
                    <p style="margin:0; font-size:12px; color:#7a7a7a;">E-posta</p>
                    <strong>{{ advisor_email|default:"-" }}</strong>
                </div>
                {% if advisor_email %}
                <a href="mailto:{{ advisor_email }}" style="display:inline-flex; align-items:center; justify-content:center; gap:8px; padding:10px 12px; border-radius:10px; border:1px solid #1db954; color:#1db954; text-decoration:none; font-weight:600;">
                    Danismana e-posta
                </a>
                {% endif %}
            </div>
            {% else %}
            <p style="margin:0; color:#94a3b8;">Henuz danisman atanmamis.</p>
            {% endif %}
        </div>

        <!-- Güvenlik İpuçları - Güncellenmiş Tasarım -->
        <div style="background:white; color:#1a1c23; border-radius:20px; padding:24px; box-shadow:0 20px 45px rgba(0,0,0,0.08); border:1px solid #e4e4e7; position:relative; overflow:hidden;">
            <div style="position:absolute; top:0; left:0; width:6px; height:100%; background:#ef4444;"></div>

            <div style="display:flex; align-items:center; gap:10px; margin-bottom:16px;">
                <div style="width:32px; height:32px; background:#fee2e2; border-radius:50%; display:flex; align-items:center; justify-content:center; color:#ef4444;">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                    </svg>
                </div>
                <h3 style="margin:0; color:#1a1c23;">Güvenlik İpuçları</h3>
            </div>

            <ul style="margin:0; padding-left:18px; line-height:1.6; color:#52525b;">
                <li>Parolan minimum 8 karakter olsun ve özel karakter içersin.</li>
                <li>Aynı parolayı farklı platformlarda kullanmamaya çalış.</li>
                <li>E-posta adresini güncel tut ki sıfırlama işlemleri sorunsuz olsun.</li>
            </ul>

            <a href="/logout/" style="margin-top:20px; display:inline-flex; align-items:center; gap:8px; color:#ef4444; text-decoration:none; font-weight:600; padding:10px 16px; background:#fee2e2; border-radius:8px; transition:background 0.2s;" onmouseover="this.style.background='#fecaca'" onmouseout="this.style.background='#fee2e2'">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                    <polyline points="16 17 21 12 16 7"></polyline>
                    <line x1="21" y1="12" x2="9" y2="12"></line>
                </svg>
                Güvenli Çıkış Yap
            </a>
        </div>
    </div>
</div>
{% endblock %}