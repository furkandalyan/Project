{% extends "eys/base.html" %}

{% block content %}
<div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
    <div>
        <div style="color:#888; font-size:13px;">{{ assignment.course.code }}</div>
        <h2 style="margin:4px 0;">{{ assignment.title }}</h2>
        <div style="color:#555; font-size:14px;">
            {% if assignment.due_at %}Teslim: {{ assignment.due_at|date:"d.m.Y H:i" }}{% else %}Teslim tarihi yok{% endif %}
            • Maks: {{ assignment.max_score }}
        </div>
    </div>
    <div style="text-align:right; font-size:13px; color:#666;">
        <div>Öğrenci: {{ total_students }}</div>
        <div>Teslim: {{ submitted_count }}</div>
        <div>Notlanan: {{ graded_count }}</div>
        <div>Ortalama: {% if average_score %}{{ average_score|floatformat:1 }}{% else %}-{% endif %}</div>
        <div>Median: {% if median_score %}{{ median_score|floatformat:1 }}{% else %}-{% endif %}</div>
        <div>Min / Max: {% if min_score %}{{ min_score|floatformat:1 }} / {{ max_score|floatformat:1 }}{% else %}-{% endif %}</div>
        <div>Std Sapma: {% if std_score %}{{ std_score|floatformat:1 }}{% else %}-{% endif %}</div>
    </div>
</div>

<div style="background:white; padding:18px; border-radius:12px; box-shadow:0 8px 22px rgba(0,0,0,0.06);">
    <div style="display:flex; justify-content:space-between; align-items:center; gap:12px;">
        <h3 style="margin:0;">Teslimler</h3>
        <div style="display:flex; gap:8px;">
            <a href="?status=" style="font-size:13px; color:{% if not status_filter %}#2459c3{% else %}black{% endif %};">Hepsi</a>
            <a href="?status=pending" style="font-size:13px; color:{% if status_filter == 'pending' %}#2459c3{% else %}black{% endif %};">Beklemede</a>
            <a href="?status=graded" style="font-size:13px; color:{% if status_filter == 'graded' %}#2459c3{% else %}black{% endif %};">Notlandı</a>
        </div>
    </div>
    <div style="margin-top:8px; display:flex; gap:10px; flex-wrap:wrap;">
        <a href="{% url 'export_submissions_zip' assignment.id %}" style="font-size:13px; color:#2459c3;">Tüm teslimleri ZIP indir</a>
        <a href="{% url 'export_submissions_csv' assignment.id %}" style="font-size:13px; color:#2459c3;">CSV dışa aktar</a>
        <a href="{% url 'send_assignment_reminders' assignment.id %}" style="font-size:13px; color:#2459c3;">Teslim etmeyenlere hatırlat</a>
        <a href="{% url 'manage_assignment_criteria' assignment.id %}" style="font-size:13px; color:#2459c3;">Rubrik düzenle</a>
        <a href="{% url 'manage_assignment_groups' assignment.id %}" style="font-size:13px; color:#2459c3;">Grupları yönet</a>
    </div>
    <div style="overflow-x:auto;">
        <table style="width:100%; border-collapse:collapse;">
            <thead>
                <tr style="background:#f7f9fc; text-align:left;">
                    <th style="padding:10px;">Öğrenci</th>
                    <th style="padding:10px;">Durum</th>
                    <th style="padding:10px;">Puan</th>
                    <th style="padding:10px;">İşlem</th>
                </tr>
            </thead>
            <tbody>
                {% for sub in submissions %}
                <tr style="border-top:1px solid #eee;">
                    <td style="padding:10px;">{{ sub.student.get_full_name|default:sub.student.username }}</td>
                    <td style="padding:10px; color:#555;">
                        {% if sub.score %}Notlandı
                        {% else %}Teslim Edildi{% endif %}
                    </td>
                    <td style="padding:10px;">{% if sub.score %}{{ sub.score }}{% else %}-{% endif %}</td>
                    <td style="padding:10px;">
                        {% if sub.attachments.all %}
                            <div style="font-size:12px; color:#666;">Ekler:
                                {% for att in sub.attachments.all %}
                                    <a href="{{ att.file.url }}" style="color:#2459c3;">v{{ att.version }}</a>{% if not forloop.last %}, {% endif %}
                                {% endfor %}
                            </div>
                        {% endif %}
                        <a href="{% url 'grade_submission' sub.id %}" style="color:#2459c3; font-weight:600;">Notla / Güncelle</a>
                    </td>
                </tr>
                {% empty %}
                <tr><td colspan="4" style="padding:12px; color:#777;">Henüz teslim yok.</td></tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>

{% if missing_students %}
<div style="background:white; padding:16px; border-radius:12px; box-shadow:0 6px 16px rgba(0,0,0,0.05); margin-top:16px;">
    <h4 style="margin-top:0;">Teslim etmeyenler ({{ missing_students|length }})</h4>
    <div style="display:flex; gap:8px; flex-wrap:wrap;">
        {% for s in missing_students %}
            <span style="padding:6px 10px; border:1px solid #eee; border-radius:8px; font-size:13px;">{{ s.get_full_name|default:s.username }}</span>
        {% endfor %}
    </div>
</div>
{% endif %}
{% endblock %}
