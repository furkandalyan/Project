{% extends "eys/base.html" %}

{% block content %}
<div style="background:white; padding:30px; border-radius:14px; box-shadow:0 15px 40px rgba(0,0,0,0.08); margin-bottom:30px; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:15px;">
    <div>
        <h2 style="font-size:32px; margin:0;">HoÅŸ geldin {{ request.user.get_full_name|default:request.user.username }} ğŸ“</h2>
        <p style="color:#666; font-size:17px; margin-top:8px;">AÅŸaÄŸÄ±dan derslerine eriÅŸebilir, ilerlemeni takip edebilirsin.</p>
    </div>
    <a href="/student/courses/" style="background:#1db954; color:white; padding:12px 24px; border-radius:8px; text-decoration:none; font-weight:600;">ğŸ“š Derslerimi GÃ¶r</a>
</div>

<div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:20px; margin-bottom:30px;">
    <div style="background:white; padding:20px; border-radius:12px; box-shadow:0 10px 30px rgba(0,0,0,0.06);">
        <p style="margin:0; color:#a0a0a0;">ğŸ“š Ders SayÄ±sÄ±</p>
        <h3 style="margin:5px 0 0 0; font-size:30px;">{{ course_count }}</h3>
    </div>
    <div style="background:white; padding:20px; border-radius:12px; box-shadow:0 10px 30px rgba(0,0,0,0.06);">
        <p style="margin:0; color:#a0a0a0;">ğŸ¯ Learning Outcome SayÄ±sÄ±</p>
        <h3 style="margin:5px 0 0 0; font-size:30px;">{{ lo_total }}</h3>
    </div>
    <div style="background:white; padding:20px; border-radius:12px; box-shadow:0 10px 30px rgba(0,0,0,0.06);">
        <p style="margin:0; color:#a0a0a0;">ğŸ“ AldÄ±ÄŸÄ±n SÄ±nav SayÄ±sÄ±</p>
        <h3 style="margin:5px 0 0 0; font-size:30px;">{{ exam_total }}</h3>
    </div>
</div>

{% if upcoming_exams %}
<div style="margin-bottom:30px;">
    <div style="display:flex; justify-content:space-between; align-items:flex-end; margin-bottom:10px;">
        <h2 style="margin:0;">YaklaÅŸan SÄ±navlar</h2>
        <p style="margin:0; color:#888; font-size:14px;">Takvime eklenen ilk 5 sÄ±nav gÃ¶rÃ¼ntÃ¼lenir.</p>
    </div>
    <div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); gap:18px;">
        {% for exam in upcoming_exams %}
        <div style="background:white; padding:20px; border-radius:14px; box-shadow:0 12px 30px rgba(0,0,0,0.08); border-top:5px solid {% if exam.status == 'soon' %}#ffb347{% elif exam.status == 'future' %}#1db954{% else %}#d1d1d1{% endif %};">
            <div style="display:flex; justify-content:space-between; align-items:center; gap:10px;">
                <div style="font-weight:600;">{{ exam.course_code }} Â· {{ exam.name }}</div>
                {% if exam.status == 'past' %}
                    <span style="font-size:12px; background:#eeeeee; color:#555; padding:4px 10px; border-radius:999px;">TamamlandÄ±</span>
                {% elif exam.status == 'soon' %}
                    <span style="font-size:12px; background:#fff0da; color:#b86a00; padding:4px 10px; border-radius:999px;">Bu Hafta</span>
                {% else %}
                    <span style="font-size:12px; background:#e5f7ee; color:#1d7c4a; padding:4px 10px; border-radius:999px;">YaklaÅŸÄ±yor</span>
                {% endif %}
            </div>
            <p style="margin:8px 0 6px 0; color:#888;">{{ exam.course_name }}</p>
            <p style="margin:0; font-weight:600;">{{ exam.display_label }}</p>
            <p style="margin:6px 0 0 0; color:#777; font-size:14px;">{{ exam.description|default:"AÃ§Ä±klama eklenmedi." }}</p>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); gap:25px;">
    <div style="background:white; padding:25px; border-radius:14px; box-shadow:0 12px 35px rgba(0,0,0,0.08);">
        <h3 style="margin-top:0;">ğŸ¯ LO BaÅŸarÄ± HaritasÄ±</h3>
        <p style="color:#888; margin-top:0;">Demo amaÃ§lÄ± Ã¶rnek baÅŸarÄ± yÃ¼zdeleri.</p>
        {% for item in lo_success_data %}
        <div style="margin-bottom:15px;">
            <div style="display:flex; justify-content:space-between; font-size:14px; color:#666;">
                <span>{{ item.label }}</span>
                <span>%{{ item.percent }}</span>
            </div>
            <div style="background:#f0f0f0; border-radius:999px; height:10px; overflow:hidden; margin-top:6px;">
                <div style="background:#1db954; height:100%; width:{{ item.percent }}%;"></div>
            </div>
        </div>
        {% endfor %}
    </div>
    <div id="exam-results" style="background:white; padding:25px; border-radius:14px; box-shadow:0 12px 35px rgba(0,0,0,0.08);">
        <h3 style="margin-top:0;">ğŸ“ NotlarÄ±m & Son Eklenen SÄ±navlar</h3>
        <p style="color:#888; margin-top:0;">Liste en gÃ¼ncel 5 sÄ±navÄ± ve not durumunu gÃ¶sterir.</p>
        {% if exam_results %}
        <div style="display:flex; flex-direction:column; gap:15px;">
            {% for exam in exam_results %}
            <div style="border:1px solid #f0f0f0; border-radius:12px; padding:15px; display:flex; justify-content:space-between; gap:20px; align-items:center;">
                <div>
                    <strong style="display:block;">{{ exam.course_code }} Â· {{ exam.name }}</strong>
                    <span style="color:#777; font-size:14px;">{{ exam.course_name }}</span>
                </div>
                <div style="text-align:right;">
                    <div style="font-size:14px; color:#888;">
                        {% if exam.has_schedule %}
                            {{ exam.display_label }}
                        {% else %}
                            Tarih bekleniyor
                        {% endif %}
                    </div>
                    {% if exam.score %}
                        <strong style="color:#1db954; font-size:20px;">{{ exam.score|floatformat:2 }}</strong>
                    {% else %}
                        <span style="color:#999; font-size:13px;">Not bekleniyor</span>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
            <div style="border:1px dashed #dcdcdc; padding:20px; border-radius:10px; text-align:center; color:#999;">
                HenÃ¼z sÄ±nav oluÅŸturulmadÄ±ÄŸÄ± iÃ§in gÃ¶sterecek veri bulunmuyor.
            </div>
        {% endif %}
    </div>
</div>

<div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); gap:25px; margin-top:30px;">
    <div id="calendar" style="background:white; padding:25px; border-radius:14px; box-shadow:0 12px 35px rgba(0,0,0,0.08);">
        <h3 style="margin-top:0;">ğŸ“… Takvimim</h3>
        <p style="color:#888; margin-top:0;">KayÄ±tlÄ± olduÄŸun derslerden gelen sÄ±nav tarihleri.</p>
        {% if calendar_days %}
            <div style="display:flex; flex-direction:column; gap:18px;">
                {% for day in calendar_days %}
                <div style="border:1px solid #f0f0f0; border-radius:12px; padding:16px;">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <div>
                            <strong style="font-size:16px;">{{ day.day_label }}</strong>
                            <p style="margin:4px 0 0 0; color:#777;">{{ day.date_label }}</p>
                        </div>
                        <span style="font-size:13px; color:#1db954; font-weight:600;">{{ day.items|length }} sÄ±nav</span>
                    </div>
                    <div style="margin-top:14px; display:flex; flex-direction:column; gap:12px;">
                        {% for exam in day.items %}
                        <div style="display:flex; justify-content:space-between; gap:12px;">
                            <div>
                                <strong style="display:block;">{{ exam.course_code }} Â· {{ exam.name }}</strong>
                                <span style="color:#888; font-size:13px;">{{ exam.course_name }}</span>
                            </div>
                            <div style="text-align:right; color:#555; font-weight:600;">{{ exam.time_label }}</div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div style="border:1px dashed #d9d9d9; border-radius:10px; padding:20px; color:#999; text-align:center;">
                Takvime eklenmiÅŸ bir sÄ±nav gÃ¶rÃ¼nmÃ¼yor.
            </div>
        {% endif %}
    </div>
    <div id="announcements" style="background:white; padding:25px; border-radius:14px; box-shadow:0 12px 35px rgba(0,0,0,0.08);">
        <div style="display:flex; justify-content:space-between; align-items:center; gap:10px;">
            <h3 style="margin:0;">ğŸ“¢ Duyurular</h3>
            <a href="{% url 'student_announcements' %}" target="_blank" rel="noopener noreferrer"
               style="font-size:13px; color:#1db954; text-decoration:none; font-weight:600;">TÃ¼mÃ¼nÃ¼ GÃ¶r â†’</a>
        </div>
        <p style="color:#888; margin-top:6px;">Ã–ÄŸretim elemanlarÄ±nÄ±n son mesajlarÄ± burada Ã¶zetlenir.</p>
        <div style="display:flex; flex-direction:column; gap:15px;">
            {% for card in announcement_cards %}
            <div style="border:1px solid #f0f0f0; border-radius:12px; padding:18px; background:#fcfcfc;">
                <p style="margin:0; color:#1db954; font-size:13px; font-weight:600;">{{ card.meta }}</p>
                <h4 style="margin:6px 0 6px 0;">{{ card.title }}</h4>
                <div style="margin:0; color:#666;">{{ card.body|safe }}</div>
                {% if card.attachment %}
                    <a href="{{ card.attachment.url }}" target="_blank" style="display: inline-block; margin-top: 10px; font-size: 13px; color: #2459c3; text-decoration: none; font-weight: 600;">ğŸ“ Eki Ä°ndir</a>
                {% endif %}
                <a href="{% url 'announcement_detail' card.id %}" style="display: inline-block; margin-top: 10px; font-size: 13px; color: #1db954; text-decoration: none; font-weight: 600;">YorumlarÄ± GÃ¶r â†’</a>
                {% if card.course_label %}
                    <p style="margin:10px 0 0 0; color:#999; font-size:13px;">{{ card.course_label }}</p>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<div id="profile-settings" style="background:white; padding:25px; border-radius:14px; box-shadow:0 12px 35px rgba(0,0,0,0.08); margin-top:30px; display:flex; flex-wrap:wrap; gap:20px; align-items:center;">
    <div style="flex:1;">
        <h3 style="margin-top:0;">ğŸ‘¤ Hesap AyarlarÄ±n</h3>
        <p style="color:#666; margin:8px 0;">Ad, soyad ve e-posta bilgilerini gÃ¼ncelleyebilir, dilersen yeni parola belirleyebilirsin.</p>
        <p style="color:#999; font-size:13px; margin:0;">Son giriÅŸ: {{ request.user.last_login|date:"d.m.Y H:i"|default:"HenÃ¼z giriÅŸ yapÄ±lmadÄ±" }}</p>
    </div>
    <a href="{% url 'student_profile' %}"
       style="display:inline-flex; align-items:center; gap:8px; background:#1db954; color:white; padding:12px 22px; border-radius:8px; text-decoration:none; font-weight:600;">
        Ayarlar SayfasÄ±na Git â†’
    </a>
</div>
{% endblock %}
