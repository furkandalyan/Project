{% extends "eys/base.html" %}

{% block content %}
<div style="display:flex; flex-direction:column; gap:18px;">
    <div style="background:linear-gradient(120deg,#0f5132,#1db954); color:white; border-radius:18px; padding:22px; box-shadow:0 22px 55px rgba(0,0,0,0.2);">
        <div style="display:flex; justify-content:space-between; align-items:flex-start;">
            <div>
                <p style="margin:0; letter-spacing:0.08em; text-transform:uppercase; font-size:12px; opacity:0.85;">Ã–ÄŸrenci Paneli</p>
                <h1 style="margin:6px 0 4px 0;">Merhaba {{ request.user.get_full_name|default:request.user.username }}</h1>
                <p style="margin:0; opacity:0.8;">Derslerinin Ã¶zetini, yaklaÅŸan sÄ±navlarÄ± ve LO baÅŸarÄ± oranlarÄ±nÄ± gÃ¶r.</p>
            </div>
        </div>
    </div>

    {% if upcoming_exams %}
    <div style="background:white; border-radius:14px; padding:16px; box-shadow:0 12px 32px rgba(0,0,0,0.08);">
        <h3 style="margin-top:0;">YaklaÅŸan SÄ±navlar</h3>
        <div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); gap:12px; margin-top:10px;">
            {% for exam in upcoming_exams %}
            <div style="border:1px solid #eef2f7; border-radius:12px; padding:12px; background:#f8fafc;">
                <div style="display:flex; justify-content:space-between; align-items:center; gap:8px;">
                    <div>
                        <strong style="display:block;">{{ exam.name }}</strong>
                        <span style="color:#777; font-size:13px;">{{ exam.course_code }} - {{ exam.course_name }}</span>
                    </div>
                    {% if exam.status == 'soon' %}
                        <span style="padding:6px 10px; border-radius:999px; background:#fff0da; color:#b86a00; font-size:12px;">Bu Hafta</span>
                    {% elif exam.status == 'future' %}
                        <span style="padding:6px 10px; border-radius:999px; background:#eeeeee; color:#555; font-size:12px;">YaklaÅŸÄ±yor</span>
                    {% endif %}
                </div>
                <p style="margin:8px 0 6px 0; color:#888; font-size:13px;">{{ exam.display_label }}</p>
                <p style="margin:0; color:#666; font-size:13px;">{{ exam.description|default:"AÃ§Ä±klama eklenmedi." }}</p>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); gap:25px;">
        <div style="background:white; padding:25px; border-radius:14px; box-shadow:0 12px 35px rgba(0,0,0,0.08);">
            <h3 style="margin-top:0;">ðŸŽ¯ LO BaÅŸarÄ± HaritasÄ±</h3>
            <p style="color:#888; margin-top:0;">LOâ€™larÄ±na baÄŸlÄ± sÄ±nav notlarÄ±na gÃ¶re hesaplandÄ±.</p>
            {% if lo_success_data %}
                {% for item in lo_success_data %}
                <div style="margin-bottom:15px;">
                    <div style="display:flex; justify-content:space-between; font-size:14px; color:#666;">
                        <span>{{ item.label }}</span>
                        <span>%{{ item.percent }}</span>
                    </div>
                    <div style="background:#f0f0f0; border-radius:999px; height:10px; overflow:hidden; margin-top:6px;">
                        <div style="background:#1db954; height:100%; width:{{ item.percent }}%;"></div>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <p style="color:#999;">HenÃ¼z LO baÅŸarÄ±sÄ± hesaplanmadÄ±.</p>
            {% endif %}
        </div>
        <div id="exam-results" style="background:white; padding:25px; border-radius:14px; box-shadow:0 12px 35px rgba(0,0,0,0.08);">
            <h3 style="margin-top:0;">ðŸ“Š NotlarÄ±m & Son SÄ±navlar</h3>
            <p style="color:#888; margin-top:0;">En gÃ¼ncel 5 sÄ±navÄ±n ve not durumun.</p>
            {% if exam_results %}
            <div style="display:flex; flex-direction:column; gap:15px;">
                {% for exam in exam_results %}
                <div style="border:1px solid #f0f0f0; border-radius:12px; padding:15px; display:flex; justify-content:space-between; gap:20px; align-items:center;">
                    <div>
                        <strong style="display:block;">{{ exam.course_code }} - {{ exam.name }}</strong>
                        <span style="color:#777; font-size:14px;">{{ exam.course_name }}</span>
                    </div>
                    <div style="text-align:right;">
                        <div style="font-size:14px; color:#888;">
                            {% if exam.has_schedule %}
                                {{ exam.display_label }}
                            {% else %}
                                Tarih bekleniyor
                            {% endif %}
                        </div>
                        {% if exam.score %}
                            <strong style="color:#1db954; font-size:20px;">{{ exam.score|floatformat:2 }}</strong>
                        {% else %}
                            <span style="color:#ffb347;">Not bekleniyor</span>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
                <p style="color:#999;">HenÃ¼z sÄ±nav notu yok.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}