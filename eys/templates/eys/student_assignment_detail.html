{% extends "eys/base.html" %}

{% block content %}
<div style="max-width:760px; margin:0 auto; display:flex; flex-direction:column; gap:16px;">
    <div style="background:white; padding:20px; border-radius:12px; box-shadow:0 8px 22px rgba(0,0,0,0.06);">
        <div style="font-size:13px; color:#888;">{{ assignment.course.code }}</div>
        <h2 style="margin:6px 0;">{{ assignment.title }}</h2>
        <div style="color:#555; font-size:14px; margin-bottom:8px;">
            {% if assignment.due_at %}Teslim: {{ assignment.due_at|date:"d.m.Y H:i" }}{% else %}Teslim tarihi yok{% endif %}
            • Maks: {{ assignment.max_score }}
        </div>
        <div style="color:#444;">{{ assignment.description|default:"Açıklama yok." }}</div>
        {% if assignment.attachment %}
            <div style="margin-top:10px;"><a href="{{ assignment.attachment.url }}" style="color:#2459c3;">Ödev dosyasını indir</a></div>
        {% endif %}
        {% if assignment.is_group %}
            <div style="margin-top:10px; padding:10px; background:#f7f9fc; border-radius:8px; color:#555;">
                Grup ödevi.
                {% if user_group %}
                    Grubun: {{ user_group.name }}
                {% else %}
                    Gruplandırma için öğretmeninle iletişime geç.
                {% endif %}
            </div>
        {% endif %}
    </div>

    <div style="background:white; padding:20px; border-radius:12px; box-shadow:0 8px 22px rgba(0,0,0,0.06);">
        <h3 style="margin-top:0;">Teslimim</h3>
        {% if submission %}
            <div style="margin-bottom:12px; font-size:14px; color:#555;">
                Gönderim: {{ submission.submitted_at|date:"d.m.Y H:i" }} |
                Durum:
                {% if submission.score %}Notlandı ({{ submission.score }})
                {% else %}Teslim Edildi{% endif %}
                {% if submission.feedback %}<br/>Geribildirim: {{ submission.feedback }}{% endif %}
            </div>
            {% if submission.file %}
                <div><a href="{{ submission.file.url }}" style="color:#2459c3;">Gönderdiğin dosyayı indir</a></div>
            {% endif %}
            {% if submission.attachments.all %}
                <div style="margin-top:6px; font-size:13px; color:#444;">Ekler:
                    {% for att in submission.attachments.all %}
                        <a href="{{ att.file.url }}" style="color:#2459c3;">v{{ att.version }}</a>{% if not forloop.last %}, {% endif %}
                    {% endfor %}
                </div>
            {% endif %}
            {% if submission.text %}
                <div style="margin-top:8px; padding:10px; background:#f7f9fc; border-radius:8px;">{{ submission.text }}</div>
            {% endif %}
        {% else %}
            <p style="color:#777;">Henüz teslim yapmadın.</p>
        {% endif %}

        <form method="POST" enctype="multipart/form-data" style="display:flex; flex-direction:column; gap:12px; margin-top:14px;">
            {% csrf_token %}
            <div id="dropzone" style="border:2px dashed #cbd5e1; border-radius:10px; padding:14px; text-align:center; color:#64748b; cursor:pointer;">
                Dosyaları buraya sürükle ya da tıkla
            </div>
            {{ form.as_p }}
            <button type="submit" style="background:#2459c3; color:white; padding:12px 0; border:none; border-radius:10px; font-weight:700; cursor:pointer;">Gönder / Güncelle</button>
        </form>
    </div>
</div>
<script>
(function() {
    const dz = document.getElementById("dropzone");
    const fileInput = document.querySelector('input[type="file"][name="attachments"]');
    if (!dz || !fileInput) return;
    dz.addEventListener("click", () => fileInput.click());
    dz.addEventListener("dragover", (e) => {
        e.preventDefault();
        dz.style.borderColor = "#2459c3";
    });
    dz.addEventListener("dragleave", () => dz.style.borderColor = "#cbd5e1");
    dz.addEventListener("drop", (e) => {
        e.preventDefault();
        dz.style.borderColor = "#cbd5e1";
        fileInput.files = e.dataTransfer.files;
    });
})();
</script>
{% endblock %}
